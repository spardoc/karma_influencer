<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Karma Influencer - Buscar</title>
    <link rel="stylesheet" href="/static/css/common.css" />
    <link rel="stylesheet" href="/static/css/index.css" />
</head>
<body>

    <header>
        <div class="icon">ðŸŽ­</div>
        <h1>Karma Influencer</h1>
    </header>

    <main class="form-container">
        <form id="scrapeForm">
            <label for="keywords">Palabras clave (separadas por coma):</label>
            <input type="text" id="keywords" name="keywords" required placeholder="elon musk, openai" />

            <label for="limit">LÃ­mite por palabra clave:</label>
            <input type="number" id="limit" name="limit" value="10" min="1" max="100" />

            <label for="platform">Red social:</label>
            <select id="platform" name="platform">
                <option value="all">Todas</option>
                <option value="reddit">Reddit</option>
                <option value="tiktok">TikTok</option>
                <option value="facebook">Facebook</option>
            </select>

            <label for="startDate">Fecha desde:</label>
            <input type="date" id="startDate" name="startDate" />

            <label for="endDate">Fecha hasta:</label>
            <input type="date" id="endDate" name="endDate" />

            <button type="submit">Realizar Scraping...</button>
        </form>

        <div id="resultado"></div>

        <div class="navigation-buttons">
            <button id="btn-comments" type="button" disabled>Ver Comentarios</button>
            <button id="btn-analytics" type="button" disabled>Ver Reportes y GrÃ¡ficos</button>
        </div>
    </main>

    <script>
        document.getElementById("scrapeForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            const keywords = document.getElementById("keywords").value.split(",").map(k => k.trim()).filter(k => k.length > 0);
            const limit = document.getElementById("limit").value;

            if (keywords.length === 0) {
                document.getElementById("resultado").innerHTML = "<p>Por favor ingresa al menos una palabra clave.</p>";
                return;
            }

            localStorage.setItem("keywords", JSON.stringify(keywords));

            const response = await fetch("/api/scrape/reddit", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ keywords, limit })
            });

            const data = await response.json();

            if (data.error) {
                document.getElementById("resultado").innerHTML = `<p style="color:red;">${data.error}</p>`;
                return;
            }

            document.getElementById("resultado").innerHTML = `<p>${data.message}</p>`;

            const query = new URLSearchParams({ keywords: keywords.join(",") }).toString();
            window.location.href = `/comments.html?${query}`;
        });

        window.addEventListener("DOMContentLoaded", () => {
            const saved = localStorage.getItem("keywords");
            if (saved) {
                const keywords = JSON.parse(saved);
                const query = new URLSearchParams({ keywords: keywords.join(",") }).toString();

                document.querySelector(".navigation-buttons").innerHTML = `
                    <button onclick="window.location.href='/comments.html?${query}'">Ver Comentarios</button>
                    <button onclick="window.location.href='/analytics.html?${query}'">Ver Reportes y GrÃ¡ficos</button>
                `;
            }
        });
    </script>

</body>
</html>